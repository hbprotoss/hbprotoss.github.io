{"THEME_REVEAL_CONGIF_TRANSITION": "cube", "LICENSE": "\n<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh\"><img alt=\"\u77e5\u8bc6\u5171\u4eab\u8bb8\u53ef\u534f\u8bae\" style=\"border-width:0\" src=\"http://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png\" /></a><br />\u672c\u4f5c\u54c1\u91c7\u7528<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh\">\u77e5\u8bc6\u5171\u4eab\u7f72\u540d-\u975e\u5546\u4e1a\u6027\u4f7f\u7528-\u7981\u6b62\u6f14\u7ece 3.0 \u672a\u672c\u5730\u5316\u7248\u672c\u8bb8\u53ef\u534f\u8bae</a>\u8fdb\u884c\u8bb8\u53ef\u3002", "text": "<html><body><p>Decorator\u662f23\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u4e00\uff0c\u63d0\u51fa\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u5728\u4e0d\u6539\u53d8\u73b0\u6709\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\uff0c\u901a\u8fc7\u5728\u5934\u90e8\u6216\u5c3e\u90e8\u6dfb\u52a0\u4ee3\u7801\u6765\u6269\u5c55\u529f\u80fd\u3002<br>\nPython\u8bed\u8a00\u5185\u5efa\u652f\u6301decorator\u6a21\u5f0f\u3002\u7531\u4e8e\u8bed\u6cd5\u4e0d\u662f\u672c\u6587\u91cd\u70b9\uff0c\u5bf9\u8bed\u6cd5\u4e0d\u719f\u6089\u7684\u7ae5\u978b\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u51e0\u7bc7\u6587\u7ae0\uff1a  </p>\n<ol><li>Stackoverflow\u4e0a\u7684\u795e\u6587\uff1a<a href=\"http://stackoverflow.com/a/1594484/837187\">Understanding Python decorators</a></li>\n<li><a href=\"http://blog.donews.com/limodou/archive/2004/12/19/207521.aspx\">[Python\u5b66\u4e60]decorator\u7684\u4f7f\u7528</a></li>\n<li><a href=\"http://www.python.org/dev/peps/pep-0318/\">PEP318</a></li>\n</ol><p>\u4e0b\u9762\u8bf4\u4e00\u4e0b\u6700\u8fd1\u5728\u5199SNS\u5ba2\u6237\u7aef\u63d2\u4ef6\u65f6Python decorator\u7684\u5e94\u7528\u3002<br>\n\u63d2\u4ef6\u7684\u65b9\u6cd5\u5b8c\u6210\u7684\u4efb\u52a1\u662f\uff1a  </p>\n<ul><li>\u6839\u636eOAuth\u534f\u8bae\uff0c\u8bbe\u7f6e\u597d\u53c2\u6570\uff0c\u8bbf\u95eeHTTP API</li>\n<li>\u8bfb\u53d6\u670d\u52a1\u5668\u8fd4\u56de\u7684json</li>\n<li>\u89e3\u6790json</li>\n</ul><p>\u5f02\u5e38\u53ef\u80fd\u6765\u81ea\u8bbf\u95eeAPI\u8fc7\u7a0b\u4e2d\u7684\u7f51\u7edc\u95ee\u9898\uff0c\u4ee5\u53ca\u89e3\u6790json\u53d1\u73b0\u670d\u52a1\u5668\u8fd4\u56de\u4e86\u9519\u8bef\u4ee3\u7801\uff08\u6bd4\u5982API\u8bbf\u95ee\u8fc7\u4e8e\u9891\u7e41\uff0caccess token\u6709\u95ee\u9898\u7b49\uff09\u3002\u5728\u5199\u5934\u51e0\u4e2aAPI\u7684\u65f6\u5019\u505a\u6cd5\u5f88\u81ea\u7136\uff0c\u7528try-except\u5757\u5305\u88f9\u53ef\u80fd\u51fa\u5f02\u5e38\u7684\u4ee3\u7801\uff0c\u5c06\u5404\u79cd\u6807\u51c6\u5e93\u7684\u5f02\u5e38\u6216\u8005\u670d\u52a1\u5668\u8fd4\u56de\u7684\u9519\u8bef\u4fe1\u606f\u5c01\u88c5\u6210\u81ea\u5df1\u7684exception\uff0craise\u4e00\u4e0b\u544a\u8bc9\u4e3b\u7a0b\u5e8f\u6709\u5f02\u5e38\u9700\u8981\u5904\u7406\u3002<br>\n\u4f46\u662f\u5199\u4e86\u51e0\u4e2a\u65b9\u6cd5\u540e\u53d1\u73b0\uff0c\u6bcf\u4e2a\u65b9\u6cd5\u7684\u5f02\u5e38\u5904\u7406\u6d41\u7a0b\u51e0\u4e4e\u4e00\u6a21\u4e00\u6837\uff0c\u7279\u522b\u662f\u5c01\u88c5\u6807\u51c6\u5e93\u7684\u5f02\u5e38\uff0c\u552f\u4e00\u4e0d\u540c\u7684\u5c31\u662f\u89e3\u6790\u670d\u52a1\u5668\u8fd4\u56de\u7684\u9519\u8bef\u4fe1\u606f\u3002\u4f2a\u7801\u5982\u4e0b\uff1a  </p>\n<div class=\"code\"><pre><span class=\"n\">def</span> <span class=\"n\">method</span><span class=\"p\">(</span><span class=\"n\">xxx</span><span class=\"p\">):</span>\n    <span class=\"n\">try:</span>\n        <span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">urllib</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">urlopen</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">headers</span><span class=\"p\">)</span>\n        <span class=\"n\">raw_data</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"nb\">read</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">decode</span><span class=\"p\">(</span><span class=\"s\">'utf-8'</span><span class=\"p\">)</span>\n        <span class=\"n\">rtn</span> <span class=\"o\">=</span> <span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">loads</span><span class=\"p\">(</span><span class=\"n\">raw_data</span><span class=\"p\">)</span>\n    <span class=\"n\">except</span> <span class=\"n\">Exception1</span> <span class=\"n\">as</span> <span class=\"n\">e:</span>\n        <span class=\"nb\">log</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">)</span>\n        <span class=\"n\">raise</span> <span class=\"n\">CustomException1</span><span class=\"p\">()</span>\n    <span class=\"n\">except</span> <span class=\"n\">Exception2</span> <span class=\"n\">as</span> <span class=\"n\">e:</span>\n        <span class=\"nb\">log</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">)</span>\n        <span class=\"n\">raise</span> <span class=\"n\">CustomException2</span><span class=\"p\">()</span>\n        <span class=\"n\">xxx</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">rtn</span>\n</pre></div>\n\n\n<p>\u51fa\u4e8e\u61d2\u7684\u539f\u56e0\uff08\u8bf4\u5f97\u597d\u542c\u70b9\uff0c\u51fa\u4e8e\u4ee3\u7801\u590d\u7528\u7684\u76ee\u7684:D)\uff0c\u5f97\u60f3\u4e2a\u529e\u6cd5\u628a\u8fd9\u4e9b\u91cd\u590d\u6027\u7684\u5de5\u4f5c\u63d0\u53d6\u51fa\u6765\u3002<br>\n\u4ed4\u7ec6\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u5728except\u5904\u7406\u5b8c\u5f02\u5e38\u4e4b\u540e\u90fd\u6ca1\u6709\u989d\u5916\u7684\u5de5\u4f5c\u9700\u8981\u8fdb\u884c\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u8fd9\u4e9b\u4ee3\u7801\u90fd\u4f4d\u4e8e\u6838\u5fc3\u5904\u7406\u4ee3\u7801\u4e4b\u540e\uff0c\u8fd9\u662f\u81ea\u7136\u5c31\u60f3\u5230\u4e86decorator\u6a21\u5f0f\uff0c\u5c06\u5f02\u5e38\u5904\u7406\u653e\u5728decorator\u91cc\uff0c\u518ddecorate\u4e00\u4e0b\u5404\u4e2a\u65b9\u6cd5\u5c31\u53ef\u4ee5\u4e86\u3002<br>\nDecorator\u5982\u4e0b\uff1a  </p>\n<div class=\"code\"><pre><span class=\"n\">def</span> <span class=\"n\">sinaMethod</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">):</span>\n    <span class=\"n\">def</span> <span class=\"n\">func_wrapper</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"n\">try:</span>\n            <span class=\"n\">raw_rtn</span> <span class=\"o\">=</span> <span class=\"n\">func</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n        <span class=\"n\">except</span> <span class=\"n\">urllib</span><span class=\"o\">.</span><span class=\"n\">error</span><span class=\"o\">.</span><span class=\"n\">HTTPError</span> <span class=\"n\">as</span> <span class=\"n\">e:</span>\n            <span class=\"k\">if</span> <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"n\">fp:</span>\n                <span class=\"c1\"># Sina app error</span>\n                <span class=\"n\">error_msg</span> <span class=\"o\">=</span> <span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">loads</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"o\">.</span><span class=\"n\">fp</span><span class=\"o\">.</span><span class=\"nb\">read</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">decode</span><span class=\"p\">(</span><span class=\"s\">'utf-8'</span><span class=\"p\">))</span>\n                <span class=\"n\">error_code</span> <span class=\"o\">=</span> <span class=\"n\">str</span><span class=\"p\">(</span><span class=\"n\">error_msg</span><span class=\"p\">[</span><span class=\"s\">'error_code'</span><span class=\"p\">])</span>\n                <span class=\"k\">if</span> <span class=\"n\">error_code</span> <span class=\"n\">in</span> <span class=\"n\">exception_dict:</span>\n                    <span class=\"n\">raise</span> <span class=\"n\">exception_dict</span><span class=\"p\">[</span><span class=\"n\">error_code</span><span class=\"p\">](</span><span class=\"n\">error_msg</span><span class=\"p\">[</span><span class=\"s\">'error'</span><span class=\"p\">])</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">raise</span> <span class=\"n\">weiUnknownError</span><span class=\"p\">(</span><span class=\"n\">str</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">))</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Network error</span>\n                <span class=\"n\">raise</span> <span class=\"n\">weiNetworkError</span><span class=\"p\">(</span><span class=\"n\">str</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">))</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">raw_rtn</span>\n    <span class=\"k\">return</span> <span class=\"n\">func_wrapper</span>\n</pre></div>\n\n\n<p>\u5176\u4f5c\u7528\u5c31\u662f\uff0c\u5c1d\u8bd5\u8c03\u7528\u88ab\u88c5\u9970\u51fd\u6570\uff0c\u5982\u679c\u987a\u5229\u7684\u8bdd\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\u3002\u5982\u679c\u6709HTTPError\u5f02\u5e38\u53d1\u751f\uff0c\u5219\u89e3\u6790\u4e4b\uff0c\u5e76\u6839\u636e\u76f8\u5e94\u60c5\u51b5\u5c01\u88c5\u6210\u81ea\u5b9a\u4e49\u7684\u5f02\u5e38\u629b\u51fa\u3002<br>\n\u8fd9\u91cc\u4f7f\u5f97\u4ee3\u7801\u6bd4\u8f83\u7b80\u77ed\u7684\u4e00\u4e2a\u5173\u952e\u5c31\u662f\u8fd9\u4e2aexception_dict\uff0c\u91cc\u9762\u7ef4\u62a4\u4e86\u65b0\u6d6a\u9519\u8bef\u4ee3\u7801\u548c\u9700\u8981\u629b\u51fa\u7684\u5f02\u5e38\u7c7b\u4e4b\u95f4\u7684\u6620\u5c04\u3002\u6839\u636e\u8fd4\u56de\u7684error_code\u67e5\u627e\u8fd9\u4e2a\u5b57\u5178\uff0c\u5982\u679c\u6709\u5219\u8bf4\u660e\u8fd9\u662f\u6211\u4eec\u9700\u8981\u5173\u5fc3\u7684\u5f02\u5e38\uff0c\u90a3\u4e48\u5c31\u7528\u9519\u8bef\u6d88\u606f\u6784\u9020\u5f02\u5e38\u5bf9\u8c61\u629b\u51fa\u3002\u5982\u679c\u6ca1\u6709\uff0c\u5c31\u4e0d\u662f\u9700\u8981\u5173\u5fc3\u7684\u5f02\u5e38\uff0c\u4ee5weiUnknownError\u5f02\u5e38\u629b\u51fa\u3002<br>\n\u7531\u4e8e\u65b0\u6d6a\u5728\u51fa\u9519\u65f6\u9664\u4e86\u8fd4\u56deHTTP\u62a5\u5934\uff0c\u8fd8\u6709\u4e00\u6bb5\u9644\u52a0data\uff0c\u6240\u4ee5\u5982\u679ce.fp\u4e3aNone\u5219\u8bf4\u660e\u4e0d\u662f\u5e94\u7528\u5c42\u7684\u5f02\u5e38\uff0c\u53ef\u80fd\u662f\u7f51\u7edc\u5c42\u53ca\u4ee5\u4e0b\u51fa\u4e86\u95ee\u9898\uff0c\u629b\u51faweiNetworkError\u3002  </p>\n<p>\u4f7f\u7528\u5c31\u5f88\u7b80\u5355\u4e86\uff0c\u5728\u88ab\u88c5\u9970\u7684\u51fd\u6570\u524d\u4e00\u884c\u52a0<code>@sinaMethod</code>\u5c31\u53ef\u4ee5\u4e86\u3002<br>\n\u5c31\u8fd9\u4e48\u7b80\u5355~~  </p>\n<hr><p>PS\uff1a\u9644\u5e26\u8bf4\u4e00\u53e5\uff0c\u7f16\u7a0b\u8bed\u8a00\u5bf9\u8bbe\u8ba1\u6a21\u5f0f\u5728\u8bed\u6cd5\u4e0a\u7684\u652f\u6301\u4f1a\u5927\u5927\u7b80\u5316\u7a0b\u5e8f\u733f\u7684\u7f16\u7801\u91cf\u3002\u5982\u679c\u662fC++/Java\uff0c\u751a\u81f3C\u8981\u7528decorator\u6a21\u5f0f\u5c31\u5f97\u534f\u5546\u8001\u957f\u4e00\u6bb5\u4e86~~^_^</p></body></html>", "ARCHIVE_FILENAME": "archive.html", "THEME_REVEAL_CONGIF_SUBTHEME": "sky", "message_Read more": "Read more", "SITE_URL": "http://hbprotoss.github.com", "LISTINGS_FOLDER": "listings", "INDEXES_PAGES": "", "next": false, "message_Next post": "Next post", "BLOG_DESCRIPTION": "\u6280\u672f\u535a\u5ba2\u4e3a\u4e3b\uff0c\u8f85\u4ee5\u5404\u79cd\u8f85\u6599\u3002\u4ed9\u5251\u8111\u6b8b\u7c89", "EXTRA_HEAD_DATA": "", "DEFAULT_LANG": "en", "disqus_html": "<div id=\"disqus_thread\"></div> <script type=\"text/javascript\">var disqus_shortname=\"hbprotoss\";var disqus_url=\"http://hbprotoss.github.com/posts/python-decoratorde-ying-yong.html\";(function(){var a=document.createElement(\"script\");a.type=\"text/javascript\";a.async=true;a.src=\"http://\"+disqus_shortname+\".disqus.com/embed.js\";(document.getElementsByTagName(\"head\")[0]||document.getElementsByTagName(\"body\")[0]).appendChild(a)})();        </script><noscript>Please enable JavaScript to view the <a href=\"http://disqus.com/?ref_noscript\">comments powered by DISQUS.</a></noscript><a href=\"http://disqus.com\"class=\"dsq-brlink\">comments powered by <span class=\"logo-disqus\">DISQUS</span></a>", "RSS_PATH": "", "title": "Python decorator\u7684\u5e94\u7528", "SEARCH_FORM": "\n<!-- Custom search -->\n<form method=\"get\" id=\"search\" action=\"http://duckduckgo.com/\"\n class=\"navbar-form pull-left\">\n<input type=\"hidden\" name=\"sites\" value=\"http://hbprotoss.github.com\"/>\n<input type=\"hidden\" name=\"k8\" value=\"#444444\"/>\n<input type=\"hidden\" name=\"k9\" value=\"#D51920\"/>\n<input type=\"hidden\" name=\"kt\" value=\"h\"/>\n<input type=\"text\" name=\"q\" maxlength=\"255\"\n placeholder=\"Search&hellip;\" class=\"span2\" style=\"margin-top: 4px;\"/>\n<input type=\"submit\" value=\"DuckDuckGo Search\" style=\"visibility: hidden;\" />\n</form>\n<!-- End of custom search -->\n", "message_Tags": "Tags", "INDEX_PATH": "", "BLOG_AUTHOR": "hbprotoss", "message_Older posts": "Older posts", "OUTPUT_FOLDER": "output", "message_Original site": "Original site", "ANALYTICS": "", "BLOG_EMAIL": "", "message_Posts for year %s": "Posts for year %s", "message_old posts page %d": "old posts page %d", "BLOG_TITLE": "hbprotoss\u7684\u535a\u5ba2", "message_Posted": "Posted", "GALLERY_PATH": "galleries", "CODE_COLOR_SCHEME": "default", "message_Read in English": "Read in English", "CACHE_FOLDER": "cache", "tags": [{"link": "/categories/python.html", "name": "Python"}, {"link": "/categories/design-pattern.html", "name": "Design Pattern"}], "tags?": true, "__file__": "conf.pyc", "translations": [], "CONTENT_FOOTER": "\n<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh\"><img alt=\"\u77e5\u8bc6\u5171\u4eab\u8bb8\u53ef\u534f\u8bae\" style=\"border-width:0\" src=\"http://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png\" /></a><br />\u672c\u4f5c\u54c1\u91c7\u7528<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh\">\u77e5\u8bc6\u5171\u4eab\u7f72\u540d-\u975e\u5546\u4e1a\u6027\u4f7f\u7528-\u7981\u6b62\u6f14\u7ece 3.0 \u672a\u672c\u5730\u5316\u7248\u672c\u8bb8\u53ef\u534f\u8bae</a>\u8fdb\u884c\u8bb8\u53ef\u3002<br />Contents &copy; 2013 <a href=\"mailto:\">hbprotoss</a> - Powered by <a href=\"http://nikola.ralsina.com.ar\">Nikola</a>", "BASE_URL": "http://hbprotoss.github.com", "THEME": "site", "GIT_DIR": "--git-dir=output/.git --work-tree=output", "message_Also available in": "Also available in", "message_Previous post": "Previous post", "date": "2013-04-03 21:23", "__name__": "conf", "message_Posts about %s": "Posts about %s", "message_More posts about": "More posts about", "ARCHIVE_PATH": "", "DATE_FORMAT": "%Y-%m-%d %H:%M", "TAG_PATH": "categories", "prev": "/posts/multipartform-datade-shi-xian.json", "message_Newer posts": "Newer posts", "message_LANGUAGE": "English", "MATHJAX_CONFIG": "", "message_Archive": "Archive", "message_Source": "Source", "DISQUS_FORUM": "hbprotoss", "INDEXES_TITLE": ""}